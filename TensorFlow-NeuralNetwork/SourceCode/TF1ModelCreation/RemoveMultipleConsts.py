import tensorflow as tf
from tensorflow.python.tools import optimize_for_inference_lib
from tensorflow.tools.graph_transforms import TransformGraph

output_names = ['conv2d_input', 'conv2d/kernel/Initializer/random_uniform/shape', 'conv2d/kernel/Initializer/random_uniform/min', 'conv2d/kernel/Initializer/random_uniform/max', 'conv2d/kernel/Initializer/random_uniform/RandomUniform', 'conv2d/kernel/Initializer/random_uniform/sub', 'conv2d/kernel/Initializer/random_uniform/mul', 'conv2d/kernel/Initializer/random_uniform', 'conv2d/kernel', 'conv2d/kernel/IsInitialized/VarIsInitializedOp', 'conv2d/kernel/Assign', 'conv2d/kernel/Read/ReadVariableOp', 'conv2d/bias/Initializer/zeros', 'conv2d/bias', 'conv2d/bias/IsInitialized/VarIsInitializedOp', 'conv2d/bias/Assign', 'conv2d/bias/Read/ReadVariableOp', 'conv2d/dilation_rate', 'conv2d/Conv2D/ReadVariableOp', 'conv2d/Conv2D', 'conv2d/BiasAdd/ReadVariableOp', 'conv2d/BiasAdd', 'activation/Relu', 'max_pooling2d/MaxPool', 'conv2d_1/kernel/Initializer/random_uniform/shape', 'conv2d_1/kernel/Initializer/random_uniform/min', 'conv2d_1/kernel/Initializer/random_uniform/max', 'conv2d_1/kernel/Initializer/random_uniform/RandomUniform', 'conv2d_1/kernel/Initializer/random_uniform/sub', 'conv2d_1/kernel/Initializer/random_uniform/mul', 'conv2d_1/kernel/Initializer/random_uniform', 'conv2d_1/kernel', 'conv2d_1/kernel/IsInitialized/VarIsInitializedOp', 'conv2d_1/kernel/Assign', 'conv2d_1/kernel/Read/ReadVariableOp', 'conv2d_1/bias/Initializer/zeros', 'conv2d_1/bias', 'conv2d_1/bias/IsInitialized/VarIsInitializedOp', 'conv2d_1/bias/Assign', 'conv2d_1/bias/Read/ReadVariableOp', 'conv2d_1/dilation_rate', 'conv2d_1/Conv2D/ReadVariableOp', 'conv2d_1/Conv2D', 'conv2d_1/BiasAdd/ReadVariableOp', 'conv2d_1/BiasAdd', 'activation_1/Relu', 'max_pooling2d_1/MaxPool', 'flatten/Shape', 'flatten/strided_slice/stack', 'flatten/strided_slice/stack_1', 'flatten/strided_slice/stack_2', 'flatten/strided_slice', 'flatten/Reshape/shape/1', 'flatten/Reshape/shape', 'flatten/Reshape', 'dense/kernel/Initializer/random_uniform/shape', 'dense/kernel/Initializer/random_uniform/min', 'dense/kernel/Initializer/random_uniform/max', 'dense/kernel/Initializer/random_uniform/RandomUniform', 'dense/kernel/Initializer/random_uniform/sub', 'dense/kernel/Initializer/random_uniform/mul', 'dense/kernel/Initializer/random_uniform', 'dense/kernel', 'dense/kernel/IsInitialized/VarIsInitializedOp', 'dense/kernel/Assign', 'dense/kernel/Read/ReadVariableOp', 'dense/bias/Initializer/zeros', 'dense/bias', 'dense/bias/IsInitialized/VarIsInitializedOp', 'dense/bias/Assign', 'dense/bias/Read/ReadVariableOp', 'dense/MatMul/ReadVariableOp', 'dense/MatMul', 'dense/BiasAdd/ReadVariableOp', 'dense/BiasAdd', 'dense_1/kernel/Initializer/random_uniform/shape', 'dense_1/kernel/Initializer/random_uniform/min', 'dense_1/kernel/Initializer/random_uniform/max', 'dense_1/kernel/Initializer/random_uniform/RandomUniform', 'dense_1/kernel/Initializer/random_uniform/sub', 'dense_1/kernel/Initializer/random_uniform/mul', 'dense_1/kernel/Initializer/random_uniform', 'dense_1/kernel', 'dense_1/kernel/IsInitialized/VarIsInitializedOp', 'dense_1/kernel/Assign', 'dense_1/kernel/Read/ReadVariableOp', 'dense_1/bias/Initializer/zeros', 'dense_1/bias', 'dense_1/bias/IsInitialized/VarIsInitializedOp', 'dense_1/bias/Assign', 'dense_1/bias/Read/ReadVariableOp', 'dense_1/MatMul/ReadVariableOp', 'dense_1/MatMul', 'dense_1/BiasAdd/ReadVariableOp', 'dense_1/BiasAdd', 'activation_2/Sigmoid', 'activation_2_target', 'total/Initializer/zeros', 'total', 'total/IsInitialized/VarIsInitializedOp', 'total/Assign', 'total/Read/ReadVariableOp', 'count/Initializer/zeros', 'count', 'count/IsInitialized/VarIsInitializedOp', 'count/Assign', 'count/Read/ReadVariableOp', 'metrics/acc/Cast/x', 'metrics/acc/Greater', 'metrics/acc/Cast_1', 'metrics/acc/Equal', 'metrics/acc/Cast_2', 'metrics/acc/Mean/reduction_indices', 'metrics/acc/Mean', 'metrics/acc/Const', 'metrics/acc/Sum', 'metrics/acc/AssignAddVariableOp', 'metrics/acc/ReadVariableOp', 'metrics/acc/Size', 'metrics/acc/Cast_3', 'metrics/acc/AssignAddVariableOp_1', 'metrics/acc/ReadVariableOp_1', 'metrics/acc/div_no_nan/ReadVariableOp', 'metrics/acc/div_no_nan/ReadVariableOp_1', 'metrics/acc/div_no_nan', 'metrics/acc/Identity', 'loss/activation_2_loss/Const', 'loss/activation_2_loss/logistic_loss/zeros_like', 'loss/activation_2_loss/logistic_loss/GreaterEqual', 'loss/activation_2_loss/logistic_loss/Select', 'loss/activation_2_loss/logistic_loss/Neg', 'loss/activation_2_loss/logistic_loss/Select_1', 'loss/activation_2_loss/logistic_loss/mul', 'loss/activation_2_loss/logistic_loss/sub', 'loss/activation_2_loss/logistic_loss/Exp', 'loss/activation_2_loss/logistic_loss/Log1p', 'loss/activation_2_loss/logistic_loss', 'loss/activation_2_loss/Mean/reduction_indices', 'loss/activation_2_loss/Mean', 'loss/activation_2_loss/weighted_loss/Cast/x', 'loss/activation_2_loss/weighted_loss/broadcast_weights/assert_broadcastable/weights/shape', 'loss/activation_2_loss/weighted_loss/broadcast_weights/assert_broadcastable/weights/rank', 'loss/activation_2_loss/weighted_loss/broadcast_weights/assert_broadcastable/values/shape', 'loss/activation_2_loss/weighted_loss/broadcast_weights/assert_broadcastable/values/rank', 'loss/activation_2_loss/weighted_loss/broadcast_weights/assert_broadcastable/static_scalar_check_success', 'loss/activation_2_loss/weighted_loss/broadcast_weights/ones_like/Shape', 'loss/activation_2_loss/weighted_loss/broadcast_weights/ones_like/Const', 'loss/activation_2_loss/weighted_loss/broadcast_weights/ones_like', 'loss/activation_2_loss/weighted_loss/broadcast_weights', 'loss/activation_2_loss/weighted_loss/Mul', 'loss/activation_2_loss/Const_1', 'loss/activation_2_loss/Sum', 'loss/activation_2_loss/num_elements', 'loss/activation_2_loss/num_elements/Cast', 'loss/activation_2_loss/Const_2', 'loss/activation_2_loss/Sum_1', 'loss/activation_2_loss/value', 'loss/mul/x', 'loss/mul', 'keras_learning_phase/input', 'keras_learning_phase', 'training/Adam/gradients/gradients/Shape', 'training/Adam/gradients/gradients/grad_ys_0', 'training/Adam/gradients/gradients/Fill', 'training/Adam/gradients/gradients/loss/mul_grad/Mul', 'training/Adam/gradients/gradients/loss/mul_grad/Mul_1', 'training/Adam/gradients/gradients/loss/activation_2_loss/value_grad/Shape', 'training/Adam/gradients/gradients/loss/activation_2_loss/value_grad/Shape_1', 'training/Adam/gradients/gradients/loss/activation_2_loss/value_grad/BroadcastGradientArgs', 'training/Adam/gradients/gradients/loss/activation_2_loss/value_grad/div_no_nan', 'training/Adam/gradients/gradients/loss/activation_2_loss/value_grad/Sum', 'training/Adam/gradients/gradients/loss/activation_2_loss/value_grad/Reshape', 'training/Adam/gradients/gradients/loss/activation_2_loss/value_grad/Neg', 'training/Adam/gradients/gradients/loss/activation_2_loss/value_grad/div_no_nan_1', 'training/Adam/gradients/gradients/loss/activation_2_loss/value_grad/div_no_nan_2', 'training/Adam/gradients/gradients/loss/activation_2_loss/value_grad/mul', 'training/Adam/gradients/gradients/loss/activation_2_loss/value_grad/Sum_1', 'training/Adam/gradients/gradients/loss/activation_2_loss/value_grad/Reshape_1', 'training/Adam/gradients/gradients/loss/activation_2_loss/Sum_1_grad/Reshape/shape', 'training/Adam/gradients/gradients/loss/activation_2_loss/Sum_1_grad/Reshape', 'training/Adam/gradients/gradients/loss/activation_2_loss/Sum_1_grad/Const', 'training/Adam/gradients/gradients/loss/activation_2_loss/Sum_1_grad/Tile', 'training/Adam/gradients/gradients/loss/activation_2_loss/Sum_grad/Reshape/shape', 'training/Adam/gradients/gradients/loss/activation_2_loss/Sum_grad/Reshape', 'training/Adam/gradients/gradients/loss/activation_2_loss/Sum_grad/Shape', 'training/Adam/gradients/gradients/loss/activation_2_loss/Sum_grad/Tile', 'training/Adam/gradients/gradients/loss/activation_2_loss/weighted_loss/Mul_grad/Shape', 'training/Adam/gradients/gradients/loss/activation_2_loss/weighted_loss/Mul_grad/Shape_1', 'training/Adam/gradients/gradients/loss/activation_2_loss/weighted_loss/Mul_grad/BroadcastGradientArgs', 'training/Adam/gradients/gradients/loss/activation_2_loss/weighted_loss/Mul_grad/Mul', 'training/Adam/gradients/gradients/loss/activation_2_loss/weighted_loss/Mul_grad/Sum', 'training/Adam/gradients/gradients/loss/activation_2_loss/weighted_loss/Mul_grad/Reshape', 'training/Adam/gradients/gradients/loss/activation_2_loss/weighted_loss/Mul_grad/Mul_1', 'training/Adam/gradients/gradients/loss/activation_2_loss/weighted_loss/Mul_grad/Sum_1', 'training/Adam/gradients/gradients/loss/activation_2_loss/weighted_loss/Mul_grad/Reshape_1', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/Shape', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/Size', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/add', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/mod', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/Shape_1', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/range/start', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/range/delta', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/range', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/Fill/value', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/Fill', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/DynamicStitch', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/Maximum/y', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/Maximum', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/floordiv', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/Reshape', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/Tile', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/Shape_2', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/Shape_3', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/Const', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/Prod', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/Const_1', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/Prod_1', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/Maximum_1/y', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/Maximum_1', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/floordiv_1', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/Cast', 'training/Adam/gradients/gradients/loss/activation_2_loss/Mean_grad/truediv', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss_grad/Shape', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss_grad/Shape_1', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss_grad/BroadcastGradientArgs', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss_grad/Sum', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss_grad/Reshape', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss_grad/Sum_1', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss_grad/Reshape_1', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/sub_grad/Shape', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/sub_grad/Shape_1', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/sub_grad/BroadcastGradientArgs', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/sub_grad/Sum', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/sub_grad/Reshape', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/sub_grad/Neg', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/sub_grad/Sum_1', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/sub_grad/Reshape_1', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/Log1p_grad/add/x', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/Log1p_grad/add', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/Log1p_grad/Reciprocal', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/Log1p_grad/mul', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/Select_grad/zeros_like', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/Select_grad/Select', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/Select_grad/Select_1', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/mul_grad/Shape', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/mul_grad/Shape_1', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/mul_grad/BroadcastGradientArgs', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/mul_grad/Mul', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/mul_grad/Sum', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/mul_grad/Reshape', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/mul_grad/Mul_1', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/mul_grad/Sum_1', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/mul_grad/Reshape_1', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/Exp_grad/mul', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/Select_1_grad/zeros_like', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/Select_1_grad/Select', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/Select_1_grad/Select_1', 'training/Adam/gradients/gradients/loss/activation_2_loss/logistic_loss/Neg_grad/Neg', 'training/Adam/gradients/gradients/AddN', 'training/Adam/gradients/gradients/dense_1/BiasAdd_grad/BiasAddGrad', 'training/Adam/gradients/gradients/dense_1/MatMul_grad/MatMul', 'training/Adam/gradients/gradients/dense_1/MatMul_grad/MatMul_1', 'training/Adam/gradients/gradients/dense/BiasAdd_grad/BiasAddGrad', 'training/Adam/gradients/gradients/dense/MatMul_grad/MatMul', 'training/Adam/gradients/gradients/dense/MatMul_grad/MatMul_1', 'training/Adam/gradients/gradients/flatten/Reshape_grad/Shape', 'training/Adam/gradients/gradients/flatten/Reshape_grad/Reshape', 'training/Adam/gradients/gradients/max_pooling2d_1/MaxPool_grad/MaxPoolGrad', 'training/Adam/gradients/gradients/activation_1/Relu_grad/ReluGrad', 'training/Adam/gradients/gradients/conv2d_1/BiasAdd_grad/BiasAddGrad', 'training/Adam/gradients/gradients/conv2d_1/Conv2D_grad/ShapeN', 'training/Adam/gradients/gradients/conv2d_1/Conv2D_grad/Conv2DBackpropInput', 'training/Adam/gradients/gradients/conv2d_1/Conv2D_grad/Conv2DBackpropFilter', 'training/Adam/gradients/gradients/max_pooling2d/MaxPool_grad/MaxPoolGrad', 'training/Adam/gradients/gradients/activation/Relu_grad/ReluGrad', 'training/Adam/gradients/gradients/conv2d/BiasAdd_grad/BiasAddGrad', 'training/Adam/gradients/gradients/conv2d/Conv2D_grad/ShapeN', 'training/Adam/gradients/gradients/conv2d/Conv2D_grad/Conv2DBackpropInput', 'training/Adam/gradients/gradients/conv2d/Conv2D_grad/Conv2DBackpropFilter', 'training/Adam/iter/Initializer/zeros', 'training/Adam/iter', 'training/Adam/iter/IsInitialized/VarIsInitializedOp', 'training/Adam/iter/Assign', 'training/Adam/iter/Read/ReadVariableOp', 'training/Adam/beta_1/Initializer/initial_value', 'training/Adam/beta_1', 'training/Adam/beta_1/IsInitialized/VarIsInitializedOp', 'training/Adam/beta_1/Assign', 'training/Adam/beta_1/Read/ReadVariableOp', 'training/Adam/beta_2/Initializer/initial_value', 'training/Adam/beta_2', 'training/Adam/beta_2/IsInitialized/VarIsInitializedOp', 'training/Adam/beta_2/Assign', 'training/Adam/beta_2/Read/ReadVariableOp', 'training/Adam/decay/Initializer/initial_value', 'training/Adam/decay', 'training/Adam/decay/IsInitialized/VarIsInitializedOp', 'training/Adam/decay/Assign', 'training/Adam/decay/Read/ReadVariableOp', 'training/Adam/learning_rate/Initializer/initial_value', 'training/Adam/learning_rate', 'training/Adam/learning_rate/IsInitialized/VarIsInitializedOp', 'training/Adam/learning_rate/Assign', 'training/Adam/learning_rate/Read/ReadVariableOp', 'training/Adam/conv2d/kernel/m/Initializer/zeros/shape_as_tensor', 'training/Adam/conv2d/kernel/m/Initializer/zeros/Const', 'training/Adam/conv2d/kernel/m/Initializer/zeros', 'training/Adam/conv2d/kernel/m', 'training/Adam/conv2d/kernel/m/IsInitialized/VarIsInitializedOp', 'training/Adam/conv2d/kernel/m/Assign', 'training/Adam/conv2d/kernel/m/Read/ReadVariableOp', 'training/Adam/conv2d/bias/m/Initializer/zeros', 'training/Adam/conv2d/bias/m', 'training/Adam/conv2d/bias/m/IsInitialized/VarIsInitializedOp', 'training/Adam/conv2d/bias/m/Assign', 'training/Adam/conv2d/bias/m/Read/ReadVariableOp', 'training/Adam/conv2d_1/kernel/m/Initializer/zeros/shape_as_tensor', 'training/Adam/conv2d_1/kernel/m/Initializer/zeros/Const', 'training/Adam/conv2d_1/kernel/m/Initializer/zeros', 'training/Adam/conv2d_1/kernel/m', 'training/Adam/conv2d_1/kernel/m/IsInitialized/VarIsInitializedOp', 'training/Adam/conv2d_1/kernel/m/Assign', 'training/Adam/conv2d_1/kernel/m/Read/ReadVariableOp', 'training/Adam/conv2d_1/bias/m/Initializer/zeros', 'training/Adam/conv2d_1/bias/m', 'training/Adam/conv2d_1/bias/m/IsInitialized/VarIsInitializedOp', 'training/Adam/conv2d_1/bias/m/Assign', 'training/Adam/conv2d_1/bias/m/Read/ReadVariableOp', 'training/Adam/dense/kernel/m/Initializer/zeros/shape_as_tensor', 'training/Adam/dense/kernel/m/Initializer/zeros/Const', 'training/Adam/dense/kernel/m/Initializer/zeros', 'training/Adam/dense/kernel/m', 'training/Adam/dense/kernel/m/IsInitialized/VarIsInitializedOp', 'training/Adam/dense/kernel/m/Assign', 'training/Adam/dense/kernel/m/Read/ReadVariableOp', 'training/Adam/dense/bias/m/Initializer/zeros', 'training/Adam/dense/bias/m', 'training/Adam/dense/bias/m/IsInitialized/VarIsInitializedOp', 'training/Adam/dense/bias/m/Assign', 'training/Adam/dense/bias/m/Read/ReadVariableOp', 'training/Adam/dense_1/kernel/m/Initializer/zeros', 'training/Adam/dense_1/kernel/m', 'training/Adam/dense_1/kernel/m/IsInitialized/VarIsInitializedOp', 'training/Adam/dense_1/kernel/m/Assign', 'training/Adam/dense_1/kernel/m/Read/ReadVariableOp', 'training/Adam/dense_1/bias/m/Initializer/zeros', 'training/Adam/dense_1/bias/m', 'training/Adam/dense_1/bias/m/IsInitialized/VarIsInitializedOp', 'training/Adam/dense_1/bias/m/Assign', 'training/Adam/dense_1/bias/m/Read/ReadVariableOp', 'training/Adam/conv2d/kernel/v/Initializer/zeros/shape_as_tensor', 'training/Adam/conv2d/kernel/v/Initializer/zeros/Const', 'training/Adam/conv2d/kernel/v/Initializer/zeros', 'training/Adam/conv2d/kernel/v', 'training/Adam/conv2d/kernel/v/IsInitialized/VarIsInitializedOp', 'training/Adam/conv2d/kernel/v/Assign', 'training/Adam/conv2d/kernel/v/Read/ReadVariableOp', 'training/Adam/conv2d/bias/v/Initializer/zeros', 'training/Adam/conv2d/bias/v', 'training/Adam/conv2d/bias/v/IsInitialized/VarIsInitializedOp', 'training/Adam/conv2d/bias/v/Assign', 'training/Adam/conv2d/bias/v/Read/ReadVariableOp', 'training/Adam/conv2d_1/kernel/v/Initializer/zeros/shape_as_tensor', 'training/Adam/conv2d_1/kernel/v/Initializer/zeros/Const', 'training/Adam/conv2d_1/kernel/v/Initializer/zeros', 'training/Adam/conv2d_1/kernel/v', 'training/Adam/conv2d_1/kernel/v/IsInitialized/VarIsInitializedOp', 'training/Adam/conv2d_1/kernel/v/Assign', 'training/Adam/conv2d_1/kernel/v/Read/ReadVariableOp', 'training/Adam/conv2d_1/bias/v/Initializer/zeros', 'training/Adam/conv2d_1/bias/v', 'training/Adam/conv2d_1/bias/v/IsInitialized/VarIsInitializedOp', 'training/Adam/conv2d_1/bias/v/Assign', 'training/Adam/conv2d_1/bias/v/Read/ReadVariableOp', 'training/Adam/dense/kernel/v/Initializer/zeros/shape_as_tensor', 'training/Adam/dense/kernel/v/Initializer/zeros/Const', 'training/Adam/dense/kernel/v/Initializer/zeros', 'training/Adam/dense/kernel/v', 'training/Adam/dense/kernel/v/IsInitialized/VarIsInitializedOp', 'training/Adam/dense/kernel/v/Assign', 'training/Adam/dense/kernel/v/Read/ReadVariableOp', 'training/Adam/dense/bias/v/Initializer/zeros', 'training/Adam/dense/bias/v', 'training/Adam/dense/bias/v/IsInitialized/VarIsInitializedOp', 'training/Adam/dense/bias/v/Assign', 'training/Adam/dense/bias/v/Read/ReadVariableOp', 'training/Adam/dense_1/kernel/v/Initializer/zeros', 'training/Adam/dense_1/kernel/v', 'training/Adam/dense_1/kernel/v/IsInitialized/VarIsInitializedOp', 'training/Adam/dense_1/kernel/v/Assign', 'training/Adam/dense_1/kernel/v/Read/ReadVariableOp', 'training/Adam/dense_1/bias/v/Initializer/zeros', 'training/Adam/dense_1/bias/v', 'training/Adam/dense_1/bias/v/IsInitialized/VarIsInitializedOp', 'training/Adam/dense_1/bias/v/Assign', 'training/Adam/dense_1/bias/v/Read/ReadVariableOp', 'training/Adam/Identity/ReadVariableOp', 'training/Adam/Identity', 'training/Adam/ReadVariableOp', 'training/Adam/add/y', 'training/Adam/add', 'training/Adam/Cast', 'training/Adam/Identity_1/ReadVariableOp', 'training/Adam/Identity_1', 'training/Adam/Identity_2/ReadVariableOp', 'training/Adam/Identity_2', 'training/Adam/Pow', 'training/Adam/Pow_1', 'training/Adam/sub/x', 'training/Adam/sub', 'training/Adam/Sqrt', 'training/Adam/sub_1/x', 'training/Adam/sub_1', 'training/Adam/truediv', 'training/Adam/mul', 'training/Adam/Const', 'training/Adam/sub_2/x', 'training/Adam/sub_2', 'training/Adam/sub_3/x', 'training/Adam/sub_3', 'training/Adam/Adam/update_conv2d/kernel/ResourceApplyAdam', 'training/Adam/Adam/update_conv2d/bias/ResourceApplyAdam', 'training/Adam/Adam/update_conv2d_1/kernel/ResourceApplyAdam', 'training/Adam/Adam/update_conv2d_1/bias/ResourceApplyAdam', 'training/Adam/Adam/update_dense/kernel/ResourceApplyAdam', 'training/Adam/Adam/update_dense/bias/ResourceApplyAdam', 'training/Adam/Adam/update_dense_1/kernel/ResourceApplyAdam', 'training/Adam/Adam/update_dense_1/bias/ResourceApplyAdam', 'training/Adam/Adam/Const', 'training/Adam/Adam/AssignAddVariableOp', 'training/Adam/Adam/ReadVariableOp', 'training_1/group_deps', 'conv2d/kernel_0/tag', 'conv2d/kernel_0/ReadVariableOp', 'conv2d/kernel_0', 'conv2d/bias_0/tag', 'conv2d/bias_0/ReadVariableOp', 'conv2d/bias_0', 'conv2d_out/tag', 'conv2d_out', 'activation_out/tag', 'activation_out', 'max_pooling2d_out/tag', 'max_pooling2d_out', 'conv2d_1/kernel_0/tag', 'conv2d_1/kernel_0/ReadVariableOp', 'conv2d_1/kernel_0', 'conv2d_1/bias_0/tag', 'conv2d_1/bias_0/ReadVariableOp', 'conv2d_1/bias_0', 'conv2d_1_out/tag', 'conv2d_1_out', 'activation_1_out/tag', 'activation_1_out', 'max_pooling2d_1_out/tag', 'max_pooling2d_1_out', 'flatten_out/tag', 'flatten_out', 'dense/kernel_0/tag', 'dense/kernel_0/ReadVariableOp', 'dense/kernel_0', 'dense/bias_0/tag', 'dense/bias_0/ReadVariableOp', 'dense/bias_0', 'dense_out/tag', 'dense_out', 'dense_1/kernel_0/tag', 'dense_1/kernel_0/ReadVariableOp', 'dense_1/kernel_0', 'dense_1/bias_0/tag', 'dense_1/bias_0/ReadVariableOp', 'dense_1/bias_0', 'dense_1_out/tag', 'dense_1_out', 'activation_2_out/tag', 'activation_2_out', 'Merge/MergeSummary', 'Placeholder', 'AssignVariableOp', 'ReadVariableOp', 'Placeholder_1', 'AssignVariableOp_1', 'ReadVariableOp_1', 'VarIsInitializedOp', 'VarIsInitializedOp_1', 'VarIsInitializedOp_2', 'VarIsInitializedOp_3', 'VarIsInitializedOp_4', 'VarIsInitializedOp_5', 'VarIsInitializedOp_6', 'VarIsInitializedOp_7', 'VarIsInitializedOp_8', 'VarIsInitializedOp_9', 'VarIsInitializedOp_10', 'VarIsInitializedOp_11', 'VarIsInitializedOp_12', 'VarIsInitializedOp_13', 'VarIsInitializedOp_14', 'VarIsInitializedOp_15', 'VarIsInitializedOp_16', 'VarIsInitializedOp_17', 'VarIsInitializedOp_18', 'VarIsInitializedOp_19', 'VarIsInitializedOp_20', 'VarIsInitializedOp_21', 'VarIsInitializedOp_22', 'VarIsInitializedOp_23', 'VarIsInitializedOp_24', 'VarIsInitializedOp_25', 'VarIsInitializedOp_26', 'VarIsInitializedOp_27', 'VarIsInitializedOp_28', 'VarIsInitializedOp_29', 'VarIsInitializedOp_30', 'init', 'evaluation/group_deps']
with tf.gfile.FastGFile('TF1Model_Frozen_Graph.pb', 'rb') as f:
    graph_def = tf.GraphDef()
    graph_def.ParseFromString(f.read())
    graph_def = optimize_for_inference_lib.optimize_for_inference(graph_def, ['Placeholder'], output_names, tf.float32.as_datatype_enum)
    graph_def = TransformGraph(graph_def, ['Placeholder'], output_names, ['remove_nodes(op=PlaceholderWithDefault)', 'sort_by_execution_order'])
    with tf.gfile.FastGFile('TF1Model_Consts_Fused.pb', 'wb') as f:
        f.write(graph_def.SerializeToString())

